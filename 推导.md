## 针对风场扰动的四旋翼 $\mathrm{S}$ 形反馈鲁棒控制方法

## 一、符号说明

文中,我们约定符号 $d$ 为目标值。我们用粗体小写字母表示向量,粗写大写体字母表示矩阵,其余情况为标量。本文使用两个右手坐标系: 惯性系 ${\mathcal{F}}_{\mathcal{I}} : \left\{  {{\mathbf{x}}_{I},{\mathbf{y}}_{I},{\mathbf{z}}_{I}}\right\}$ ,其中 ${z}_{I}$ 指向下方与重力方向相同; 机体系 ${\mathcal{F}}_{\mathcal{B}} : \left\{  {{x}_{B},{y}_{B},{z}_{B}}\right\}$ ,其中 ${x}_{B}$ 指向机头方向, ${z}_{B}$ 与总推力方向相反 (见图 1)。带上标的 $B$ 的向量,表示在机体系当中,否则在惯性系中表示。 从 ${\mathcal{F}}_{\mathcal{I}}$ 到 ${\mathcal{F}}_{\mathcal{B}}$ 的旋转由旋转矩阵 $R\left( \mathbf{q}\right)  = {\left\lbrack  {\mathbf{x}}_{B},{\mathbf{y}}_{B},{\mathbf{z}}_{B}\right\rbrack  }^{\mathrm{T}} \in  \mathrm{{SO}}\left( 3\right)$ 表示,该矩阵通过四元数 $\mathbf{q} = {\left\lbrack  {q}_{w},{q}_{x},{q}_{y},{q}_{z}\right\rbrack  }^{T} \in  {\mathbb{S}}^{3}$ 参数化。

<!-- Media -->

<!-- figureText: ${\widehat{\omega }}_{4}$ ${\omega }_{1}$ ${x}_{B}$ $\beta$ 0 ${y}_{B}$ ${z}_{B}$ ${x}_{I}$ ${\omega }_{3}$ ${y}_{I}$ $g$ -->

<img src="https://cdn.noedgeai.com/bo_d4ttb8ref24c73bejudg_0.jpg?x=333&y=818&w=1072&h=756&r=0"/>

图 1 坐标系定义与螺旋桨编号约定

<!-- Media -->

## 二、四旋翼模型

四旋翼模型基于 6 自由度刚体运动学和动力学方程建立。对于平动动力学,我们有:

$$
\ddot{\xi } = \left( {-T{z}_{B} + {f}_{a}}\right) /m + g \tag{1}
$$

其中 $\mathbf{\xi }$ 表示四旋翼质心位置; $T$ 和 $m$ 分别为总推力和总质量; $\mathbf{g}$ 为重力矢量; ${\mathbf{f}}_{a}$ 为受到的外部不确定扰动。

旋转运动学和动力学的方程表示为:


$$
\dot{\mathbf{q}} = \frac{1}{2}\mathbf{q} \otimes  \left\lbrack  \begin{matrix} 0 \\  {\mathbf{\Omega }}^{B} \end{matrix}\right\rbrack   \tag{2}
$$

$$
{\mathbf{I}}_{v}{\dot{\mathbf{\Omega }}}^{B} = {\mathbf{I}}_{v}{\mathbf{\alpha }}^{B} =  - {\mathbf{\Omega }}^{B} \times  {\mathbf{I}}_{v}{\mathbf{\Omega }}^{B} + {\mathbf{\tau }}_{\text{all }} \tag{3}
$$

其中 $\otimes$ 表示四元数乘法算子。 ${\mathbf{\Omega }}^{B} = {\left\lbrack  {\Omega }_{x},{\Omega }_{y},{\Omega }_{z}\right\rbrack  }^{T}$ 为从惯性测量单元 (IMU) 测得的角速度向量, $\mathbf{\Omega }$ 的导数即角加速度,记为 $\alpha$ 。 ${\mathbf{I}}_{v}$ 表示整个四旋翼的惯性矩阵。 ${\mathbf{\tau }}_{all}$ 是合力矩,包括由旋翼产生的力矩 $\tau$ 和外部不确定扰动力矩 ${\mathbf{\tau }}_{\text{dis }}$ :

$$
{\mathbf{\tau }}_{\text{all }} = \mathbf{\tau } + {\mathbf{\tau }}_{\text{dis }} \tag{4}
$$

总推力 $T$ 和旋翼产生的力矩 $\mathbf{\tau }$ 是转速 $\omega$ 的函数

$$
\left\lbrack  \begin{matrix} T \\  \mathbf{\tau } \end{matrix}\right\rbrack   = {\mathbf{G}}_{1}\mathbf{u} + {\mathbf{G}}_{2}\dot{\mathbf{\omega }} + {\mathbf{G}}_{3}\left( \mathbf{\Omega }\right) \mathbf{\omega } \tag{5}
$$

其中:

$$
\mathbf{u} = {c}_{t}{\mathbf{\omega }}^{\circ 2} \tag{6}
$$

表示每个旋翼产生的升力, ${c}_{t}$ 表示为旋翼拉力系数,。表示 Hadamard 幂。 $\mathbf{\omega }$ 是每个螺旋桨角速度的向量。

${\mathbf{G}}_{1}$ 至 ${\mathbf{G}}_{3}$ 矩阵是如下定义的矩阵:

$$
{\mathbf{G}}_{1} = \left\lbrack  \begin{matrix} 1 & 1 & 1 & 1 \\  l\sin \beta &  - l\sin \beta &  - l\sin \beta & l\sin \beta \\  l\cos \beta & l\cos \beta &  - l\cos \beta &  - l\cos \beta \\   - {c}_{q}/{c}_{t} & {c}_{q}/{c}_{t} &  - {c}_{q}/{c}_{t} & {c}_{q}/{c}_{t} \end{matrix}\right\rbrack   \tag{7}
$$

$$
{\mathbf{G}}_{2} = \left\lbrack  \begin{matrix} 0 & 0 & 0 & 0 \\  0 & 0 & 0 & 0 \\  0 & 0 & 0 & 0 \\   - {I}_{p} & {I}_{p} &  - {I}_{p} & {I}_{p} \end{matrix}\right\rbrack   \tag{8}
$$

$$
{\mathbf{G}}_{3} = \left\lbrack  \begin{matrix} 0 & 0 & 0 & 0 \\  {I}_{p}{\Omega }_{y} &  - {I}_{p}{\Omega }_{y} & {I}_{p}{\Omega }_{y} &  - {I}_{p}{\Omega }_{y} \\  {I}_{p}{\Omega }_{x} &  - {I}_{p}{\Omega }_{x} & {I}_{p}{\Omega }_{x} &  - {I}_{p}{\Omega }_{x} \\  0 & 0 & 0 & 0 \end{matrix}\right\rbrack   \tag{9}
$$

其中 ${c}_{q}$ 是力矩系数; $\beta$ 和 $l$ 是根据图 1 定义的几何参数。 ${I}_{p}$ 是旋翼绕 ${\mathbf{z}}_{B}$ 轴的转动惯量。 ${\mathbf{G}}_{2}\dot{\mathbf{\omega }}$ 和 ${\mathbf{G}}_{3}\left( \mathbf{\Omega }\right) \mathbf{\omega }$ 分别表示旋翼角加速度和陀螺仪效应产生的力矩,通常在控制器设计中忽略不计。


## 三、控制器设计

目前,大多数控制器采用线性反馈,这类方法容易引起过冲和估计信号尖峰, 而实际系统中的状态和控制量往往存在约束, 这进一步加剧了问题。此外, 在常规反步法框架中, 李亚普诺夫函数通常用于约束输出变量, 而对速度与加速度的约束则需要借助其他方法单独处理。为克服上述局限,本文提出采用光滑且有界的双曲正切函数作为反馈形式。双曲正切函数属于 $\mathrm{S}$ 形函数类,该反馈将同时用于反馈调节与扰动观测器设计。

整体控制系统结构如图 2 所示, 采用位置-姿态级联控制架构。外环位置控制器基于反步法设计, 引入双曲正切函数, 并通过扰动观测器补偿不确定性, 最终输出期望推力矢量。随后, 根据期望偏航角与推力矢量解析得到以四元数表示的期望姿态及总推力大小。通过比较当前姿态与期望姿态的四元数表示, 计算误差四元数并提取误差轴-角矢量,将其输入至姿态控制器。姿态控制器的设计步骤与外环控制器一致。最后,将控制器输出的总推力与总力矩左乘控制分配矩阵 ${\mathbf{G}}_{1}$ 的逆,解算得到各个旋翼的转速。

<!-- Media -->

<!-- figureText: Inertial Frame Body Frame Attitude controller (23)-(26) ${\mathbf{G}}_{1}^{-1}$ Attitude observer $\left( {27}\right)  - \left( {29}\right)$ ${T}_{d}$ Position ${T}_{d}{z}_{n,d}$ controller (10)-(12) $\xi ,\dot{\xi }$ $q,{\Omega }^{B}$ $e$ . Thrust vector and Yaw to Attitude Position $\left( {17}\right)  - \left( {22}\right)$ observer (13)-(15) -->

<img src="https://cdn.noedgeai.com/bo_d4ttb8ref24c73bejudg_2.jpg?x=269&y=1111&w=1119&h=394&r=0"/>

## 图 2 控制器控制框图

<!-- Media -->

## A. 位置环控制器设计

由参考文献 https://www.mathnet.ru/trspy1372 的设计步骤可知, 我们设期望位置向量为 ${\xi }_{d}$ ,定义误差

$$
{\mathbf{e}}_{\xi } = \xi  - {\xi }_{d} \tag{10}
$$

$$
{\mathbf{e}}_{v} = \dot{\xi } + {\mathbf{M}}_{1}\tanh \left( {{\mathbf{K}}_{1}{\mathbf{e}}_{\xi }}\right)  \tag{11}
$$

其位置控制律, 即推力矢量为:


$$
{T}_{d}{\mathbf{z}}_{B,d} = m\left( {\widetilde{\mathbf{f}} + \mathbf{g} + {\mathbf{M}}_{2}\tanh \left( {{\mathbf{K}}_{2}{\mathbf{e}}_{v}}\right) }\right)  \tag{12}
$$

其中 $\widetilde{\mathbf{f}} = \frac{{\mathbf{f}}_{a}}{m} + \frac{d\left( {{\mathbf{M}}_{1}\tanh \left( {{\mathbf{K}}_{1}{\mathbf{e}}_{\xi }}\right) }\right) }{dt}$ 为不确定的外部扰动与项 ${\mathbf{M}}_{1}\tanh \left( {{\mathbf{K}}_{1}{\mathbf{e}}_{\xi }}\right)$ 对时间的导数, 根据文献中的内容, 对于有界的外部扰动, 我们设计位置扰动观测器为如下形式:

$$
{\dot{\widehat{\mathbf{e}}}}_{v} =  - {T}_{d}{\mathbf{z}}_{B,d}/m + \mathbf{g} + {\mathbf{\mu }}_{v} \tag{13}
$$

其中 ${\widehat{\mathbf{e}}}_{v}$ 为观测器的状态向量, ${\mathbf{\mu }}_{v}$ 为校正作用向量。引入观测误差向量:

$$
{\mathbf{\varepsilon }}_{v} = {\mathbf{e}}_{v} - {\widehat{\mathbf{e}}}_{v} \tag{14}
$$

将矫正作用选为依赖 ${\varepsilon }_{v}$ 的 $\mathrm{S}$ 形函数

$$
{\mathbf{\mu }}_{v}\left( {\mathbf{\varepsilon }}_{v}\right)  = {\mathbf{P}}_{v}\tanh \left( {{\mathbf{L}}_{v}{\mathbf{\varepsilon }}_{v}}\right)  \tag{15}
$$

由文献中的内容, 观测的的校正作用能够在给定时间以给定精度提供估计, 即:

$$
{\mu }_{v} \approx  \widetilde{f} \tag{16}
$$

## B. 推力矢量分解

根据前文内容, 期望总推力的大小为:

$$
{T}_{d} = \begin{Vmatrix}{m\left( {{\mathbf{\mu }}_{v} + \mathbf{g} + {\mathbf{M}}_{2}\tanh \left( {{\mathbf{K}}_{2}{\mathbf{e}}_{v}}\right) }\right) }\end{Vmatrix} \tag{17}
$$

机体系的单位向量 ${\mathbf{z}}_{B}$ 在惯性系下的期望方向 ${\mathbf{z}}_{B,d}$ 为:

$$
{\mathbf{z}}_{B,d} = \frac{m\left( {{\mathbf{\mu }}_{v} + \mathbf{g} + {\mathbf{M}}_{2}\tanh \left( {{\mathbf{K}}_{2}{\mathbf{e}}_{v}}\right) }\right) }{\begin{Vmatrix}m\left( {\mathbf{\mu }}_{v} + \mathbf{g} + {\mathbf{M}}_{2}\tanh \left( {\mathbf{K}}_{2}{\mathbf{e}}_{v}\right) \right) \end{Vmatrix}} \tag{18}
$$

根据四旋翼无人机的微分平坦特性,对于位置控制,我们除了需要设置目标位置矢量,还需要设置目标航向角 ${\psi }_{d}$ ,才能够通过推力矢量分解法得到期望姿态。

此时我们可以得到一个中间轴 ${\mathbf{x}}_{C,d}$ :

$$
{\mathbf{x}}_{C,d} = {\left\lbrack  \cos {\psi }_{d},\sin {\psi }_{d},0\right\rbrack  }^{T} \tag{19}
$$

通过该轴可以由以下方程获得姿态:

$$
{\mathbf{y}}_{B,d} = \frac{{\mathbf{z}}_{B,d} \times  {\mathbf{x}}_{C,d}}{\begin{Vmatrix}{\mathbf{z}}_{B,d} \times  {\mathbf{x}}_{C,d}\end{Vmatrix}} \tag{20}
$$

$$
{\mathbf{x}}_{B,d} = \frac{{\mathbf{y}}_{B,d} \times  {\mathbf{z}}_{B,d}}{\begin{Vmatrix}{\mathbf{y}}_{B,d} \times  {\mathbf{z}}_{B,d}\end{Vmatrix}} \tag{21}
$$

$$
{R}_{d}\left( {\mathbf{q}}_{d}\right)  = {\left\lbrack  {\mathbf{x}}_{B,d},{\mathbf{y}}_{B,d},{\mathbf{z}}_{B,d}\right\rbrack  }^{\mathrm{T}} \tag{22}
$$


其中 ${\mathbf{q}}_{d}$ 是以四元数表示的期望姿态。

## C. 姿态环控制器设计

首先我们通过以下公式计算四元数误差：

$$
{\mathbf{q}}_{e}^{ * } = {\mathbf{q}}_{d} \otimes  {\mathbf{q}}^{-1} \tag{23}
$$

其中, ${\mathbf{q}}_{e}^{ * }$ 表示未处理的四元数误差, ${\mathbf{q}}^{-1}$ 表示对四元数求逆。

由于四元数属于 ${\mathbb{S}}^{3}$ ,其双倍覆盖 $\mathrm{{SO}}\left( 3\right)$ ,所以我们对其做以下处理,利用符号函数 sgn 提取 ${\mathbf{q}}_{e}^{ * }$ 的标量 ${q}_{ew}^{ * }$ 的符号,并与 ${\mathbf{q}}_{e}^{ * }$ 相乘,得到能够作为姿态控制器误差反馈的 ${\mathbf{q}}_{e} :$

$$
{\mathbf{q}}_{e} = \operatorname{sgn}\left( {q}_{ew}^{ * }\right) {\mathbf{q}}_{e}^{ * } \tag{24}
$$

四元数误差 ${\mathbf{q}}_{e}$ 的虚部部分 ${\left\lbrack  {q}_{ex},{q}_{ey},{q}_{ez}\right\rbrack  }^{T}$ 则包含了误差轴角矢量信息。我们直接将其作为误差矢量 ${\mathbf{e}}_{\theta }$ ,设计姿态环控制律,设计过程与位置环类似。

定义角速度误差:

$$
{\mathbf{e}}_{\Omega } = {\mathbf{\Omega }}^{B} + {\mathbf{M}}_{2}\tanh \left( {{\mathbf{K}}_{2}{\mathbf{e}}_{\theta }}\right)  \tag{25}
$$

期望的力矩矢量控制律为:

$$
{\mathbf{\tau }}_{d} = {\mathbf{\Omega }}^{B} \times  {\mathbf{I}}_{v}{\mathbf{\Omega }}^{B} - {\mathbf{\tau }}_{dis} - {\mathbf{I}}_{v}{\mathbf{M}}_{2}\tanh \left( {{\mathbf{K}}_{2}{\mathbf{e}}_{\Omega }}\right)  \tag{26}
$$

由于 ${\tau }_{dis}$ 是外部不确定扰动,设计姿态扰动观测器为如下形式:

$$
{\dot{\widehat{\mathbf{e}}}}_{\Omega } =  - {\mathbf{I}}_{v}\left( {{\Omega }^{B} \times  {\mathbf{I}}_{v}{\Omega }^{B}}\right)  + {\mathbf{I}}_{v}^{-1}{\tau }_{d} + {\mathbf{\mu }}_{\Omega } \tag{27}
$$

设计观测误差向量为:

$$
{\mathbf{\varepsilon }}_{\Omega } = {\mathbf{e}}_{\Omega } - {\widehat{\mathbf{e}}}_{\Omega } \tag{28}
$$

将矫正作用 ${\mathbf{\mu }}_{\Omega }$ 选为依赖 ${\mathbf{\varepsilon }}_{\Omega }$ 的 $\mathrm{S}$ 形函数

$$
{\mathbf{\mu }}_{\Omega }\left( {\mathbf{\varepsilon }}_{\Omega }\right)  = {\mathbf{P}}_{\Omega }\tanh \left( {{\mathbf{L}}_{\Omega }{\mathbf{\varepsilon }}_{\Omega }}\right)  \tag{29}
$$

由文献中的内容, 观测的的校正作用能够在给定时间以给定精度提供估计, 即:

$$
{\mathbf{\mu }}_{\Omega } \approx  {\mathbf{I}}_{v}^{-1}{\mathbf{\tau }}_{\text{dis }} \tag{30}
$$

于是最终姿态控制律可以表示为:

$$
{\mathbf{\tau }}_{d} = {\mathbf{\Omega }}^{B} \times  {\mathbf{I}}_{v}{\mathbf{\Omega }}^{B} - {\mathbf{I}}_{v}{\mathbf{\mu }}_{\Omega } - {\mathbf{I}}_{v}{\mathbf{M}}_{2}\tanh \left( {{\mathbf{K}}_{2}{\mathbf{e}}_{\Omega }}\right)  \tag{31}
$$